---
title: 在Vlab内网虚拟机搭建Minecraft服务器的尝试与总结
date: 2025-07-25
excerpt: "本次的目标是在中科大（USTC）Vlab 提供的内网虚拟机上搭建一个 Paper Minecraft (1.21.8) 服务器，并尝试通过内网穿透使其能从公网访问。"
tags:
  - 笔记
---

### **1\. 初始服务器配置**

* **Java 版本错误 (UnsupportedClassVersionError)**  
  * **问题**: Paper 1.21.8 (类文件版本 65.0) 需要 Java 21 才能运行。  
  * **尝试**: 最初安装的 openjdk-17-jre-headless (类文件版本 61.0) 版本过低。  
  * **解决**: 通过 sudo apt install openjdk-21-jre-headless 安装 Java 21 后，服务器成功在本地启动。

### **2\. 寻找公网暴露方案**

服务器在本地成功运行，但 Vlab 虚拟机没有公网IP，必须寻找方案将其暴露到公网。

* **排查系统代理设置**  
  * **发现**: 根据截图信息，系统中存在一个“代理服务器配置”界面。  
  * **分析**: 该配置为“正向代理”（Forward Proxy），其作用是让虚拟机通过一个中间服务器去访问外部互联网（管理出站流量）。  
  * **结论**: 此功能与我们的目标——让外部玩家连接到虚拟机（需要入站流量）——无关，因此不是可行的解决方案。  
* **尝试内网穿透工具**  
  * **尝试一：cpolar (失败)**  
    * **现象**: ping www.cpolar.com 时，DNS 解析被劫持，返回 127.0.0.1 (localhost)。  
    * **结果**: cpolar 客户端运行时，无法连接到其云服务器，状态卡在 connecting。  
  * **尝试二：ngrok (失败)**  
    * **现象**: ping www.ngrok.com 的 DNS 解析*看似*正常。但实际运行客户端时，其日志显示连接 connect.ngrok-agent.com:443 时，该域名**同样**被解析到了 127.0.0.1。  
    * **结果**: 客户端卡在 reconnecting (failed to dial ngrok server... dial tcp 127.0.0.1:443)。

### **经验总结**

1. **Vlab 屏蔽了主流穿透服务**：中科大 Vlab 的网络环境在 DNS 层面主动屏蔽（劫持）了 cpolar 和 ngrok 等常见的公网穿透服务，导致这些工具无法使用。  
2. **ping 检查的重要性**：ping 不仅是测试网络是否连通，更是检查 DNS 解析是否被劫持（如返回 127.0.0.1）的关键手段。  
3. **区分代理类型**：要明确“正向代理”（管出去）和“反向代理/内网穿透”（管进来）的区别，避免在错误的方向上浪费时间。  
4. **最终解决方案 (frp)**：在这种受限网络环境下，唯一可靠的穿透方案是使用**自建的 frp** (Fast Reverse Proxy)。这需要你**额外拥有一台带公网IP的VPS**作为 frps（服务端），然后在 Vlab 虚拟机上运行 frpc（客户端）去连接你自己VPS的IP地址，从而绕开 Vlab 对特定域名的屏蔽。